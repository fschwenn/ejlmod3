# -*- coding: UTF-8 -*-
# crawls iop web page to get metadata of individual IOP articles
#
# FS 2023-12-06

import os
import sys
import ejlmod3
import re
import time
from bs4 import BeautifulSoup
import urllib.request, urllib.error, urllib.parse
import undetected_chromedriver as uc

publisher = 'IOP'
regexpiopurl = re.compile('http...iopscience.iop.org.')
regexpdxdoi = re.compile('http...dx.doi.org.')

skipalreadyharvested = True
bunchsize = 10

jnlfilename = 'IOP_QIS_retro.' + ejlmod3.stampoftoday()
if skipalreadyharvested:
    alreadyharvested = ejlmod3.getalreadyharvested(jnlfilename)


#driver
host = os.uname()[1]
if host == 'l00schwenn':
    options = uc.ChromeOptions()
    options.binary_location='/usr/bin/chromium'
    chromeversion = int(re.sub('.*?(\d+).*', r'\1', os.popen('%s --version' % (options.binary_location)).read().strip()))
    driver = uc.Chrome(version_main=chromeversion, options=options)
else:
    options = uc.ChromeOptions()
    options.binary_location='/usr/bin/chromium-browser'
    options.add_argument('--headless')
    chromeversion = int(re.sub('.*?(\d+).*', r'\1', os.popen('%s --version' % (options.binary_location)).read().strip()))
    driver = uc.Chrome(version_main=chromeversion, options=options)
    driver.implicitly_wait(30)

sample = {'10.1088/1361-6633/aa7e1a' : {'all' : 192, 'core' : 142},
          '10.1088/0305-4470/36/14/101' : {'all' : 309, 'core' : 141},
          '10.1088/1361-6633/aab406' : {'all' : 175, 'core' : 130},
          '10.1088/2058-9565/ab8e92' : {'all' : 124, 'core' : 119},
          '10.1088/1751-8113/42/50/504003' : {'all' : 225, 'core' : 115},
          '10.1088/1367-2630/16/4/045014' : {'all' : 155, 'core' : 110},
          '10.1088/1464-4266/7/10/021' : {'all' : 124, 'core' : 104},
          '10.1088/1361-6633/ab85b8' : {'all' : 123, 'core' : 104},
          '10.1088/0034-4885/76/7/076001' : {'all' : 121, 'core' : 102},
          '10.1088/1751-8113/47/42/424006' : {'all' : 206, 'core' : 100},
          '10.1088/1367-2630/11/7/075001' : {'all' : 112, 'core' : 92},
          '10.1088/0305-4470/34/35/315' : {'all' : 213, 'core' : 91},
          '10.1088/1742-5468/2016/06/064007' : {'all' : 229, 'core' : 90},
          '10.1088/0953-4075/49/20/202001' : {'all' : 126, 'core' : 89},
          '10.1088/1361-6633/aac9f1' : {'all' : 216, 'core' : 86},
          '10.1088/0305-4470/22/17/002' : {'all' : 134, 'core' : 80},
          '10.1088/0034-4885/77/9/094001' : {'all' : 156, 'core' : 78},
          '10.1088/1751-8113/42/36/365303' : {'all' : 163, 'core' : 77},
          '10.1088/1361-6633/ab3a7e' : {'all' : 107, 'core' : 74},
          '10.1088/1367-2630/aad1ea' : {'all' : 125, 'core' : 72},
          '10.1088/1367-2630/9/6/199' : {'all' : 84, 'core' : 71},
          '10.1088/1751-8113/49/14/143001' : {'all' : 193, 'core' : 70},
          '10.1088/0034-4885/29/1/306' : {'all' : 151, 'core' : 70},
          '10.1088/0305-4470/32/7/007' : {'all' : 183, 'core' : 69},
          '10.1088/0305-4470/15/10/028' : {'all' : 99, 'core' : 68},
          '10.1088/1367-2630/aae94a' : {'all' : 78, 'core' : 68},
          '10.1088/1751-8121/42/50/500301' : {'all' : 131, 'core' : 67},
          '10.1088/1367-2630/16/1/013009' : {'all' : 95, 'core' : 64},
          '10.1088/1361-6633/aad5b2' : {'all' : 115, 'core' : 61},
          '10.1088/1367-2630/13/4/043016' : {'all' : 74, 'core' : 59},
          '10.1088/1367-2630/ab784c' : {'all' : 63, 'core' : 57},
          '10.1088/1367-2630/11/4/045021' : {'all' : 93, 'core' : 56},
          '10.1088/1748-0221/9/05/C05013' : {'all' : 116, 'core' : 56},
          '10.1088/1748-0221/9/05/c05013' : {'all' : 116, 'core' : 56},
          '10.1088/1367-2630/14/10/103035' : {'all' : 74, 'core' : 55},
          '10.1209/epl/i2004-10101-2' : {'all' : 113, 'core' : 52},
          '10.1088/0034-4885/77/5/056503' : {'all' : 135, 'core' : 51},
          '10.1088/1367-2630/10/7/073013' : {'all' : 104, 'core' : 51},
          '10.1088/1367-2630/15/12/123012' : {'all' : 61, 'core' : 50},
          '10.1088/0034-4885/72/4/046401' : {'all' : 85, 'core' : 49},
          '10.1088/1742-5468/2016/06/064001' : {'all' : 112, 'core' : 49},
          '10.1088/1751-8113/48/8/083001' : {'all' : 78, 'core' : 47},
          '10.1088/2058-9565/abd891' : {'all' : 50, 'core' : 47},
          '10.1088/0034-4885/74/10/104401' : {'all' : 73, 'core' : 46},
          '10.1088/1367-2630/17/8/083002' : {'all' : 55, 'core' : 46},
          '10.1088/1367-2630/17/7/075015' : {'all' : 110, 'core' : 46},
          '10.1088/1367-2630/17/11/113020' : {'all' : 53, 'core' : 45},
          '10.1088/1367-2630/12/4/043034' : {'all' : 63, 'core' : 44},
          '10.1209/0295-5075/119/60002' : {'all' : 50, 'core' : 44},
          '10.1088/1367-2630/ab867b' : {'all' : 45, 'core' : 42},
          '10.1088/1367-2630/14/12/123016' : {'all' : 68, 'core' : 41},
          '10.1088/2058-9565/abf51a' : {'all' : 44, 'core' : 41},
          '10.1088/1751-8113/41/23/235303' : {'all' : 68, 'core' : 40},
          '10.1088/1367-2630/13/12/123001' : {'all' : 52, 'core' : 40},
          '10.1088/1464-4266/6/10/003' : {'all' : 119, 'core' : 40},
          '10.7567/1882-0786/ab248d' : {'all' : 112, 'core' : 40},
          '10.1088/0034-4885/77/1/016001' : {'all' : 79, 'core' : 39},
          '10.1088/1367-2630/14/11/113011' : {'all' : 63, 'core' : 39},
          '10.1088/0741-3335/57/11/113001' : {'all' : 241, 'core' : 39},
          '10.1088/0034-4885/75/12/126001' : {'all' : 144, 'core' : 39},
          '10.1088/1367-2630/12/7/075008' : {'all' : 83, 'core' : 38},
          '10.1088/1367-2630/aab919' : {'all' : 40, 'core' : 38},
          '10.1088/0305-4470/12/5/007' : {'all' : 105, 'core' : 38},
          '10.1088/1367-2630/14/9/095022' : {'all' : 64, 'core' : 37},
          '10.1088/0034-4885/75/8/082401' : {'all' : 53, 'core' : 37},
          '10.1088/1367-2630/15/11/113022' : {'all' : 46, 'core' : 37},
          '10.1088/0034-4885/70/8/R03' : {'all' : 44, 'core' : 37},
          '10.1088/1674-1137/32/3/017' : {'all' : 37, 'core' : 37},
          '10.1088/2058-9565/aaa3a0' : {'all' : 40, 'core' : 36},
          '10.1088/0953-8984/28/21/213001' : {'all' : 67, 'core' : 35},
          '10.1209/0295-5075/83/30004' : {'all' : 66, 'core' : 35},
          '10.1088/1361-6668/ab8617' : {'all' : 37, 'core' : 35},
          '10.1088/0022-3719/7/6/005' : {'all' : 126, 'core' : 35},
          '10.1088/1742-5468/2012/07/P07016' : {'all' : 109, 'core' : 35},
          '10.1088/0026-1394/38/1/4' : {'all' : 106, 'core' : 35},
          '10.1088/1742-5468/2014/11/P11013' : {'all' : 54, 'core' : 34},
          '10.1088/1742-5468/2014/11/p11013' : {'all' : 54, 'core' : 34},
          '10.1088/1751-8113/43/6/065203' : {'all' : 43, 'core' : 34},
          '10.1088/0305-4470/39/36/R01' : {'all' : 40, 'core' : 34},
          '10.1088/1751-8113/47/10/105301' : {'all' : 39, 'core' : 34},
          '10.1088/1367-2630/15/1/013021' : {'all' : 39, 'core' : 34},
          '10.1088/0305-4608/5/5/017' : {'all' : 95, 'core' : 33},
          '10.1088/0305-4470/34/35/335' : {'all' : 58, 'core' : 33},
          '10.1088/0305-4470/17/7/003' : {'all' : 47, 'core' : 33},
          '10.1088/1367-2630/11/4/045018' : {'all' : 46, 'core' : 33},
          '10.1088/1367-2630/18/3/033032' : {'all' : 36, 'core' : 33},
          '10.1088/0953-8984/21/39/395502' : {'all' : 102, 'core' : 33},
          '10.1088/1367-2630/10/3/033023' : {'all' : 76, 'core' : 32},
          '10.1088/0034-4885/69/5/R02' : {'all' : 75, 'core' : 32},
          '10.1088/1367-2630/17/3/033033' : {'all' : 61, 'core' : 32},
          '10.1088/1367-2630/17/5/053048' : {'all' : 52, 'core' : 32},
          '10.1088/1367-2630/ab5c60' : {'all' : 40, 'core' : 32},
          '10.1088/0034-4885/66/12/R01' : {'all' : 93, 'core' : 31},
          '10.1088/0305-4470/36/47/008' : {'all' : 74, 'core' : 31},
          '10.1088/0305-4470/4/3/009' : {'all' : 72, 'core' : 31},
          '10.1088/0953-4075/40/18/R01' : {'all' : 60, 'core' : 31},
          '10.1088/1367-2630/11/4/043029' : {'all' : 42, 'core' : 31},
          '10.1088/0953-4075/44/15/154002' : {'all' : 42, 'core' : 31},
          '10.1088/1367-2630/aafb8e' : {'all' : 39, 'core' : 31},
          '10.1088/1367-2630/aa8487' : {'all' : 39, 'core' : 31},
          '10.1088/1742-5468/2013/09/P09005' : {'all' : 124, 'core' : 31},
          '10.1088/1367-2630/18/3/035006' : {'all' : 72, 'core' : 30},
          '10.1088/1361-6455/ab52ef' : {'all' : 70, 'core' : 30},
          '10.1088/1751-8113/47/3/035305' : {'all' : 146, 'core' : 30},
          '10.1238/Physica.Topical.076a00165' : {'all' : 45, 'core' : 29},
          '10.1209/0295-5075/125/30004' : {'all' : 35, 'core' : 29},
          '10.1088/1367-2630/aab7cd' : {'all' : 35, 'core' : 29},
          '10.1088/1367-2630/4/1/344' : {'all' : 34, 'core' : 29},
          '10.1088/1367-2630/12/1/013013' : {'all' : 81, 'core' : 28},
          '10.1088/1367-2630/16/12/123020' : {'all' : 50, 'core' : 28},
          '10.1088/1742-5468/2014/10/P10011' : {'all' : 41, 'core' : 28},
          '10.1088/1367-2630/16/10/103032' : {'all' : 35, 'core' : 28},
          '10.1088/2399-6528/ac1df7' : {'all' : 29, 'core' : 28},
          '10.1088/1367-2630/aac54f' : {'all' : 29, 'core' : 28},
          '10.1088/1367-2630/12/2/025012' : {'all' : 84, 'core' : 27},
          '10.1088/1367-2630/10/11/113019' : {'all' : 72, 'core' : 27},
          '10.1088/1367-2630/12/5/055026' : {'all' : 67, 'core' : 27},
          '10.1088/1367-2630/13/11/113036' : {'all' : 66, 'core' : 27},
          '10.1088/1367-2630/18/2/023045' : {'all' : 57, 'core' : 27},
          '10.1088/1361-6633/aa872f' : {'all' : 56, 'core' : 27},
          '10.1070/SM1967v001n04ABEH001994' : {'all' : 48, 'core' : 27},
          '10.1088/1367-2630/16/3/033027' : {'all' : 45, 'core' : 27},
          '10.1088/1751-8113/45/45/455304' : {'all' : 42, 'core' : 27},
          '10.1088/1367-2630/14/10/103013' : {'all' : 41, 'core' : 27},
          '10.1088/1367-2630/17/2/022002' : {'all' : 40, 'core' : 27},
          '10.1209/0295-5075/126/60002' : {'all' : 33, 'core' : 27},
          '10.1088/1367-2630/18/1/012002' : {'all' : 30, 'core' : 27},
          '10.1088/1367-2630/aab341' : {'all' : 29, 'core' : 27},
          '10.1088/1367-2630/17/4/043027' : {'all' : 29, 'core' : 27},
          '10.1088/1367-2630/aa5e47' : {'all' : 28, 'core' : 27},
          '10.1088/1367-2630/17/12/123010' : {'all' : 27, 'core' : 27},
          '10.1088/1751-8121/ab8ef3' : {'all' : 54, 'core' : 26},
          '10.1088/0034-4885/78/4/042001' : {'all' : 41, 'core' : 26},
          '10.1088/0253-6102/45/5/013' : {'all' : 35, 'core' : 26},
          '10.1209/0295-5075/134/10002' : {'all' : 31, 'core' : 26},
          '10.1088/1367-2630/16/9/093021' : {'all' : 31, 'core' : 26},
          '10.1088/1367-2630/12/11/113026' : {'all' : 31, 'core' : 26},
          '10.1088/1367-2630/10/1/013002' : {'all' : 31, 'core' : 26},
          '10.1088/1367-2630/18/6/063029' : {'all' : 27, 'core' : 26},
          '10.1088/1367-2630/10/4/043026' : {'all' : 125, 'core' : 26},
          '10.1088/1367-2630/aaecee' : {'all' : 64, 'core' : 25},
          '10.1088/0022-3719/7/9/009' : {'all' : 64, 'core' : 25},
          '10.1088/1751-8113/49/12/123001' : {'all' : 62, 'core' : 25},
          '10.1088/1361-6633/ab46e5' : {'all' : 59, 'core' : 25},
          '10.1088/1367-2630/ab68fd' : {'all' : 30, 'core' : 25},
          '10.1088/0305-4470/27/6/030' : {'all' : 27, 'core' : 25},
          '10.1088/1367-2630/11/5/055049' : {'all' : 94, 'core' : 24},
          '10.1088/0034-4885/80/1/016401' : {'all' : 69, 'core' : 24},
          '10.1088/1367-2630/18/9/093020' : {'all' : 47, 'core' : 24},
          '10.1088/1367-2630/ab8efa' : {'all' : 33, 'core' : 24},
          '10.1088/2058-9565/aa955a' : {'all' : 27, 'core' : 24},
          '10.1088/1751-8121/aa77b8' : {'all' : 26, 'core' : 24},
          '10.1088/1367-2630/11/1/013061' : {'all' : 26, 'core' : 24},
          '10.1088/1367-2630/16/3/033040' : {'all' : 25, 'core' : 24},
          '10.1088/1751-8113/42/15/153001' : {'all' : 147, 'core' : 24},
          '10.1088/0034-4885/72/12/126401' : {'all' : 95, 'core' : 23},
          '10.1088/0305-4470/8/4/012' : {'all' : 67, 'core' : 23},
          '10.1088/1367-2630/14/10/103001' : {'all' : 64, 'core' : 23},
          '10.1088/1009-9271/2/3/248' : {'all' : 61, 'core' : 23},
          '10.1088/1367-2630/16/10/103011' : {'all' : 51, 'core' : 23},
          '10.1088/0034-4885/50/12/003' : {'all' : 41, 'core' : 23},
          '10.1088/1751-8113/45/24/244002' : {'all' : 36, 'core' : 23},
          '10.1088/1367-2630/15/12/125020' : {'all' : 30, 'core' : 23},
          '10.1088/1367-2630/13/9/093036' : {'all' : 29, 'core' : 23},
          '10.1088/2058-9565/abdbc9' : {'all' : 27, 'core' : 23},
          '10.1088/1367-2630/15/2/023006' : {'all' : 27, 'core' : 23},
          '10.1088/0034-4885/75/2/022001' : {'all' : 26, 'core' : 23},
          '10.1088/1367-2630/18/6/065008' : {'all' : 25, 'core' : 23},
          '10.1088/0305-4470/10/12/016' : {'all' : 73, 'core' : 22},
          '10.1088/0305-4470/25/21/023' : {'all' : 58, 'core' : 22},
          '10.1088/0034-4885/75/2/024401' : {'all' : 51, 'core' : 22},
          '10.1088/0953-4075/49/15/152001' : {'all' : 50, 'core' : 22},
          '10.1209/0295-5075/19/8/007' : {'all' : 45, 'core' : 22},
          '10.1088/1751-8121/ab8111' : {'all' : 34, 'core' : 22},
          '10.1088/1464-4266/7/10/025' : {'all' : 30, 'core' : 22},
          '10.1088/1367-2630/12/6/063027' : {'all' : 29, 'core' : 22},
          '10.1088/1751-8113/47/47/474009' : {'all' : 27, 'core' : 22},
          '10.1088/1367-2630/11/8/085006' : {'all' : 26, 'core' : 22},
          '10.1088/0256-307X/38/3/030302' : {'all' : 26, 'core' : 22},
          '10.1088/1367-2630/ab3a62' : {'all' : 24, 'core' : 22},
          '10.1088/1367-2630/15/11/115012' : {'all' : 23, 'core' : 22},
          '10.1088/1742-5468/2007/10/P10014' : {'all' : 81, 'core' : 21},
          '10.1088/0031-8949/91/5/053001' : {'all' : 67, 'core' : 21},
          '10.1088/1367-2630/17/3/033002' : {'all' : 64, 'core' : 21},
          '10.1088/1361-6633/aabf61' : {'all' : 48, 'core' : 21},
          '10.1088/1367-2630/ab31ef' : {'all' : 39, 'core' : 21},
          '10.1088/0305-4470/14/12/019' : {'all' : 37, 'core' : 21},
          '10.1088/1742-5468/2005/05/P05012' : {'all' : 34, 'core' : 21},
          '10.1088/1367-2630/15/9/095004' : {'all' : 31, 'core' : 21},
          '10.1088/1361-6455/ab526f' : {'all' : 30, 'core' : 21},
          '10.1088/1751-8113/47/14/145003' : {'all' : 29, 'core' : 21},
          '10.1088/1367-2630/11/7/073023' : {'all' : 25, 'core' : 21},
          '10.1088/1367-2630/13/7/073024' : {'all' : 23, 'core' : 21},
          '10.1088/1367-2630/11/6/065003' : {'all' : 23, 'core' : 21},
          '10.1088/1751-8113/49/29/295301' : {'all' : 22, 'core' : 21},
          '10.1088/1367-2630/ac325f' : {'all' : 22, 'core' : 21},
          '10.1088/0022-3719/7/12/004' : {'all' : 22, 'core' : 21},
          '10.1088/0370-1298/68/10/304' : {'all' : 125, 'core' : 21},
          '10.1088/1367-2630/17/9/093039' : {'all' : 118, 'core' : 21},
          '10.1088/0953-4075/35/17/301' : {'all' : 57, 'core' : 20},
          '10.1088/1367-2630/18/6/063032' : {'all' : 55, 'core' : 20},
          '10.1088/1367-2630/12/6/065038' : {'all' : 50, 'core' : 20},
          '10.1088/1367-2630/ab54ac' : {'all' : 48, 'core' : 20},
          '10.1238/Physica.Topical.076a00127' : {'all' : 40, 'core' : 20},
          '10.1088/2058-9565/aaba1a' : {'all' : 40, 'core' : 20},
          '10.1088/1367-2630/14/9/093040' : {'all' : 40, 'core' : 20},
          '10.1088/1367-2630/12/2/025009' : {'all' : 40, 'core' : 20},
          '10.1088/1751-8121/aa5a65' : {'all' : 39, 'core' : 20},
          '10.1088/0305-4470/39/43/009' : {'all' : 29, 'core' : 20},
          '10.1088/1538-3873/aabadf' : {'all' : 280, 'core' : 20},
          '10.1088/1367-2630/15/11/113007' : {'all' : 27, 'core' : 20},
          '10.1088/1538-3873/aae8ac' : {'all' : 255, 'core' : 20},
          '10.1088/1751-8113/42/9/095302' : {'all' : 25, 'core' : 20},
          '10.1088/1367-2630/15/10/103002' : {'all' : 25, 'core' : 20},
          '10.1088/1367-2630/aa59c4' : {'all' : 24, 'core' : 20},
          '10.1088/1367-2630/8/8/126' : {'all' : 24, 'core' : 20},
          '10.1209/0295-5075/128/67003' : {'all' : 70, 'core' : 19},
          '10.1088/1367-2630/aa964f' : {'all' : 57, 'core' : 19},
          '10.1238/Physica.Topical.090a00128' : {'all' : 41, 'core' : 19},
          '10.1088/1367-2630/aaf07d' : {'all' : 37, 'core' : 19},
          '10.1088/1464-4266/6/6/014' : {'all' : 36, 'core' : 19},
          '10.1088/1367-2630/ab5330' : {'all' : 29, 'core' : 19},
          '10.1088/1367-2630/4/1/341' : {'all' : 24, 'core' : 19},
          '10.1209/epl/i2005-10424-4' : {'all' : 23, 'core' : 19},
          '10.1088/0264-9381/29/22/220301' : {'all' : 23, 'core' : 19},
          '10.1088/1367-2630/11/10/105001' : {'all' : 22, 'core' : 19},
          '10.1088/1367-2630/14/11/115023' : {'all' : 21, 'core' : 19},
          '10.1088/1367-2630/aaa398' : {'all' : 19, 'core' : 19},
          '10.1088/0034-4885/78/11/114001' : {'all' : 62, 'core' : 18},
          '10.1088/1681-7575/ab4089' : {'all' : 59, 'core' : 18},
          '10.1088/1355-5111/8/1/015' : {'all' : 41, 'core' : 18},
          '10.1088/1367-2630/17/11/113029' : {'all' : 38, 'core' : 18},
          '10.1088/1367-2630/ab0134' : {'all' : 36, 'core' : 18},
          '10.1088/1751-8113/44/14/145304' : {'all' : 33, 'core' : 18},
          '10.1088/0305-4470/27/12/028' : {'all' : 32, 'core' : 18},
          '10.1088/1751-8113/41/25/255304' : {'all' : 29, 'core' : 18},
          '10.1088/1367-2630/18/3/033024' : {'all' : 29, 'core' : 18},
          '10.1088/1367-2630/4/1/343' : {'all' : 27, 'core' : 18},
          '10.1088/1367-2630/4/1/346' : {'all' : 25, 'core' : 18},
          '10.1088/1367-2630/ab573e' : {'all' : 24, 'core' : 18},
          '10.1088/1367-2630/18/7/073011' : {'all' : 22, 'core' : 18},
          '10.1088/1367-2630/16/12/123030' : {'all' : 21, 'core' : 18},
          '10.1088/1367-2630/ab14b5' : {'all' : 20, 'core' : 18},
          '10.1088/1367-2630/11/4/045017' : {'all' : 20, 'core' : 18},
          '10.1088/2058-9565/abe567' : {'all' : 19, 'core' : 18},
          '10.1088/1367-2630/17/2/023037' : {'all' : 19, 'core' : 18},
          '10.1088/2058-9565/abe107' : {'all' : 18, 'core' : 18},
          '10.1088/1367-2630/ab0199' : {'all' : 18, 'core' : 18},
          '10.1088/0741-3335/58/10/103001' : {'all' : 80, 'core' : 17},
          '10.1088/0953-2048/28/8/084003' : {'all' : 60, 'core' : 17},
          '10.1088/1751-8113/41/49/493001' : {'all' : 55, 'core' : 17},
          '10.1088/1367-2630/13/6/065025' : {'all' : 52, 'core' : 17},
          '10.1088/1367-2630/13/2/025025' : {'all' : 51, 'core' : 17},
          '10.1088/2040-8978/18/10/104005' : {'all' : 48, 'core' : 17},
          '10.1088/1751-8113/44/9/095305' : {'all' : 45, 'core' : 17},
          '10.1088/1367-2630/18/1/013008' : {'all' : 34, 'core' : 17},
          '10.1088/1367-2630/abaa01' : {'all' : 32, 'core' : 17},
          '10.1088/1367-2630/13/10/105003' : {'all' : 31, 'core' : 17},
          '10.1088/0953-8984/16/11/045' : {'all' : 30, 'core' : 17},
          '10.1088/1367-2630/14/9/095024' : {'all' : 28, 'core' : 17},
          '10.1088/1367-2630/ab05f7' : {'all' : 23, 'core' : 17},
          '10.1088/1751-8113/44/44/445308' : {'all' : 21, 'core' : 17},
          '10.1088/1367-2630/16/6/063038' : {'all' : 21, 'core' : 17},
          '10.1088/0305-4470/10/11/021' : {'all' : 21, 'core' : 17},
          '10.1088/1367-2630/ab41a2' : {'all' : 20, 'core' : 17},
          '10.1088/1367-2630/14/6/063006' : {'all' : 20, 'core' : 17},
          '10.1088/2058-9565/abc6f4' : {'all' : 19, 'core' : 17},
          '10.1088/1751-8113/44/15/155301' : {'all' : 19, 'core' : 17},
          '10.1088/1367-2630/ab2a9e' : {'all' : 19, 'core' : 17},
          '10.1088/0305-4470/26/24/001' : {'all' : 17, 'core' : 17},
          '10.1088/2399-6528/aab64a' : {'all' : 141, 'core' : 17},
          '10.1088/0034-4885/56/12/001' : {'all' : 83, 'core' : 16},
          '10.1209/0295-5075/107/20004' : {'all' : 54, 'core' : 16},
          '10.1088/0953-8984/14/15/201' : {'all' : 52, 'core' : 16},
          '10.1088/0031-8949/2009/T137/014001' : {'all' : 34, 'core' : 16},
          '10.1088/1751-8113/42/5/055305' : {'all' : 31, 'core' : 16},
          '10.1088/1367-2630/ab91fc' : {'all' : 29, 'core' : 16},
          '10.1088/1367-2630/ab4149' : {'all' : 29, 'core' : 16},
          '10.1088/0305-4470/34/35/314' : {'all' : 28, 'core' : 16},
          '10.1088/1361-648X/aa7648' : {'all' : 27, 'core' : 16},
          '10.1088/2632-2153/ab9802' : {'all' : 24, 'core' : 16},
          '10.1088/1367-2630/ab098b' : {'all' : 24, 'core' : 16},
          '10.1088/1367-2630/14/7/075003' : {'all' : 24, 'core' : 16},
          '10.1209/0295-5075/89/40004' : {'all' : 23, 'core' : 16},
          '10.1088/1367-2630/18/8/083036' : {'all' : 23, 'core' : 16},
          '10.1088/0953-4075/41/14/145506' : {'all' : 23, 'core' : 16},
          '10.1209/0295-5075/123/60001' : {'all' : 21, 'core' : 16},
          '10.1088/0953-4075/42/11/114014' : {'all' : 21, 'core' : 16},
          '10.1088/1361-648X/aa761f' : {'all' : 20, 'core' : 16},
          '10.1088/1367-2630/17/5/053014' : {'all' : 19, 'core' : 16},
          '10.1088/1367-2630/aad89b' : {'all' : 18, 'core' : 16},
          '10.1088/1367-2630/16/4/043005' : {'all' : 18, 'core' : 16},
          '10.1088/0305-4470/30/18/026' : {'all' : 18, 'core' : 16},
          '10.1088/0305-4470/30/16/005' : {'all' : 18, 'core' : 16},
          '10.1088/1367-2630/abfa63' : {'all' : 17, 'core' : 16},
          '10.1088/1367-2630/aaec34' : {'all' : 17, 'core' : 16},
          '10.1088/1674-1137/32/7/012' : {'all' : 16, 'core' : 16},
          '10.1088/1367-2630/5/1/356' : {'all' : 99, 'core' : 15},
          '10.1088/1361-648X/aa8f79' : {'all' : 53, 'core' : 15},
          '10.1088/1367-2630/11/3/033003' : {'all' : 48, 'core' : 15},
          '10.1088/1361-6633/abcd7a' : {'all' : 47, 'core' : 15},
          '10.1088/1367-2630/17/3/035012' : {'all' : 46, 'core' : 15},
          '10.1088/1367-2630/ab60f4' : {'all' : 39, 'core' : 15},
          '10.1088/1367-2630/14/11/113023' : {'all' : 30, 'core' : 15},
          '10.1088/0305-4470/24/4/003' : {'all' : 28, 'core' : 15},
          '10.1088/1367-2630/12/5/053002' : {'all' : 27, 'core' : 15},
          '10.1088/2632-2153/ab9a21' : {'all' : 23, 'core' : 15},
          '10.1088/1751-8113/49/18/185301' : {'all' : 23, 'core' : 15},
          '10.1088/1367-2630/17/6/065008' : {'all' : 23, 'core' : 15},
          '10.1088/1367-2630/11/4/045012' : {'all' : 21, 'core' : 15},
          '10.1088/2632-2153/abc609' : {'all' : 19, 'core' : 15},
          '10.1088/2040-8978/18/8/083002' : {'all' : 19, 'core' : 15},
          '10.1088/1361-6668/aae548' : {'all' : 19, 'core' : 15},
          '10.1209/0295-5075/86/60004' : {'all' : 18, 'core' : 15},
          '10.1088/2632-2153/ab9009' : {'all' : 18, 'core' : 15},
          '10.1088/1367-2630/aba8d4' : {'all' : 18, 'core' : 15},
          '10.1088/1367-2630/ab8e5c' : {'all' : 18, 'core' : 15},
          '10.1088/1367-2630/18/4/043038' : {'all' : 18, 'core' : 15},
          '10.1088/1367-2630/ab09b0' : {'all' : 17, 'core' : 15},
          '10.1088/1367-2630/18/12/123007' : {'all' : 17, 'core' : 15},
          '10.1088/2632-2153/ac104d' : {'all' : 16, 'core' : 15},
          '10.1088/1742-6596/698/1/012003' : {'all' : 16, 'core' : 15},
          '10.1088/1367-2630/18/8/083015' : {'all' : 16, 'core' : 15},
          '10.1088/0370-1298/65/3/301' : {'all' : 15, 'core' : 15},
          '10.1088/1742-5468/2009/02/P02035' : {'all' : 50, 'core' : 14},
          '10.1088/1367-2630/14/6/063014' : {'all' : 35, 'core' : 14},
          '10.1209/0295-5075/95/50001' : {'all' : 34, 'core' : 14},
          '10.1088/0953-4075/45/11/113001' : {'all' : 34, 'core' : 14},
          '10.1209/0295-5075/133/60001' : {'all' : 33, 'core' : 14},
          '10.1088/1367-2630/aaf9f5' : {'all' : 33, 'core' : 14},
          '10.1088/1361-6633/aa5170' : {'all' : 33, 'core' : 14},
          '10.1088/1361-6455/aa743a' : {'all' : 32, 'core' : 14},
          '10.1088/1367-2630/17/11/113010' : {'all' : 29, 'core' : 14},
          '10.1209/epl/i1998-00381-x' : {'all' : 27, 'core' : 14},
          '10.1088/1367-2630/ab8ef7' : {'all' : 27, 'core' : 14},
          '10.1088/1367-2630/10/3/033032' : {'all' : 26, 'core' : 14},
          '10.1088/1751-8121/ab8b78' : {'all' : 24, 'core' : 14},
          '10.1088/2058-9565/abc1bb' : {'all' : 23, 'core' : 14},
          '10.1088/1367-2630/aac2aa' : {'all' : 22, 'core' : 14},
          '10.1088/0034-4885/76/9/096001' : {'all' : 20, 'core' : 14},
          '10.1088/1367-2630/18/10/103018' : {'all' : 19, 'core' : 14},
          '10.1088/1367-2630/16/8/083005' : {'all' : 19, 'core' : 14},
          '10.1088/0034-4885/75/7/072001' : {'all' : 18, 'core' : 14},
          '10.1088/2633-1357/abb0d7' : {'all' : 17, 'core' : 14},
          '10.1088/1367-2630/aaf29e' : {'all' : 17, 'core' : 14},
          '10.1088/1367-2630/11/2/025002' : {'all' : 17, 'core' : 14},
          '10.1088/1367-2630/ab6cdd' : {'all' : 16, 'core' : 14},
          '10.1088/1367-2630/7/1/215' : {'all' : 16, 'core' : 14},
          '10.1088/1367-2630/18/4/043021' : {'all' : 16, 'core' : 14},
          '10.1088/1367-2630/12/10/103042' : {'all' : 16, 'core' : 14},
          '10.1088/0953-2048/24/6/065001' : {'all' : 16, 'core' : 14},
          '10.1088/0953-2048/23/10/105014' : {'all' : 16, 'core' : 14},
          '10.1088/1367-2630/9/8/250' : {'all' : 14, 'core' : 14},
          '10.1088/1367-2630/17/12/122002' : {'all' : 46, 'core' : 13},
          '10.1088/1367-2630/18/7/075019' : {'all' : 43, 'core' : 13},
          '10.1088/1751-8113/40/5/011' : {'all' : 38, 'core' : 13},
          '10.1088/1742-5468/2010/05/L05002' : {'all' : 36, 'core' : 13},
          '10.1088/1367-2630/16/11/113043' : {'all' : 35, 'core' : 13},
          '10.1088/0953-4075/45/15/154001' : {'all' : 33, 'core' : 13},
          '10.1088/1742-5468/aa7e55' : {'all' : 31, 'core' : 13},
          '10.1088/1464-4266/6/8/032' : {'all' : 31, 'core' : 13},
          '10.1088/1742-6596/302/1/012037' : {'all' : 27, 'core' : 13},
          '10.1088/1367-2630/18/3/035013' : {'all' : 24, 'core' : 13},
          '10.1088/1367-2630/ab73cd' : {'all' : 22, 'core' : 13},
          '10.1088/1367-2630/aadfa8' : {'all' : 22, 'core' : 13},
          '10.1088/1367-2630/13/1/013003' : {'all' : 22, 'core' : 13},
          '10.1088/1751-8113/45/15/155301' : {'all' : 19, 'core' : 13},
          '10.1088/1367-2630/ab14a0' : {'all' : 19, 'core' : 13},
          '10.1088/1751-8121/aaade5' : {'all' : 18, 'core' : 13},
          '10.1088/1367-2630/ab1800' : {'all' : 17, 'core' : 13},
          '10.1088/2632-2153/abab5f' : {'all' : 16, 'core' : 13},
          '10.1088/1367-2630/ab193d' : {'all' : 16, 'core' : 13},
          '10.1088/0953-4075/43/21/215508' : {'all' : 16, 'core' : 13},
          '10.1088/1367-2630/ab83d1' : {'all' : 15, 'core' : 13},
          '10.1088/2058-9565/ac1e00' : {'all' : 14, 'core' : 13},
          '10.1088/1367-2630/abef98' : {'all' : 14, 'core' : 13},
          '10.1088/0953-4075/42/15/154009' : {'all' : 14, 'core' : 13},
          '10.1088/1367-2630/11/4/045023' : {'all' : 13, 'core' : 13},
          '10.1088/1367-2630/18/1/015001' : {'all' : 75, 'core' : 12},
          '10.1088/1367-2630/14/10/103033' : {'all' : 46, 'core' : 12},
          '10.1088/1367-2630/13/2/025013' : {'all' : 43, 'core' : 12},
          '10.1088/1367-2630/16/3/033007' : {'all' : 36, 'core' : 12},
          '10.1088/0305-4470/37/17/004' : {'all' : 36, 'core' : 12},
          '10.1088/1367-2630/17/4/043011' : {'all' : 35, 'core' : 12},
          '10.1088/2040-8978/18/7/073002' : {'all' : 31, 'core' : 12},
          '10.1088/1367-2630/13/9/095004' : {'all' : 30, 'core' : 12},
          '10.1088/0953-8984/18/21/S08' : {'all' : 28, 'core' : 12},
          '10.1088/1367-2630/ab5020' : {'all' : 27, 'core' : 12},
          '10.1088/1367-2630/16/6/063039' : {'all' : 26, 'core' : 12},
          '10.1088/0305-4470/38/26/010' : {'all' : 26, 'core' : 12},
          '10.1088/1367-2630/15/8/085028' : {'all' : 25, 'core' : 12},
          '10.1088/1361-6633/aa8731' : {'all' : 25, 'core' : 12},
          '10.1088/1367-2630/14/5/053030' : {'all' : 24, 'core' : 12},
          '10.1088/1751-8113/43/44/445305' : {'all' : 22, 'core' : 12},
          '10.1088/0305-4470/34/35/305' : {'all' : 22, 'core' : 12},
          '10.1088/1367-2630/ab3773' : {'all' : 21, 'core' : 12},
          '10.1088/1367-2630/11/4/045011' : {'all' : 18, 'core' : 12},
          '10.1088/2058-9565/aa5f8d' : {'all' : 16, 'core' : 12},
          '10.1088/1751-8113/46/4/045304' : {'all' : 16, 'core' : 12},
          '10.1088/0953-2048/29/4/044001' : {'all' : 16, 'core' : 12},
          '10.1088/2058-9565/abbc74' : {'all' : 15, 'core' : 12},
          '10.1088/1367-2630/16/1/013047' : {'all' : 15, 'core' : 12},
          '10.1088/1367-2630/14/9/093048' : {'all' : 15, 'core' : 12},
          '10.1088/1367-2630/11/4/045007' : {'all' : 15, 'core' : 12},
          '10.1088/1367-2630/aac9e7' : {'all' : 14, 'core' : 12},
          '10.1088/1367-2630/14/10/103017' : {'all' : 14, 'core' : 12},
          '10.1088/2058-9565/abdca4' : {'all' : 13, 'core' : 12},
          '10.1088/1402-4896/aab084' : {'all' : 12, 'core' : 12},
          '10.1088/1367-2630/ab4fd6' : {'all' : 12, 'core' : 12},
          '10.1088/0256-307X/34/9/090302' : {'all' : 12, 'core' : 12},
          '10.1088/0022-3719/6/10/009' : {'all' : 34, 'core' : 11},
          '10.1209/0295-5075/106/20001' : {'all' : 32, 'core' : 11},
          '10.1088/1367-2630/17/11/113001' : {'all' : 30, 'core' : 11},
          '10.1088/1367-2630/12/8/083014' : {'all' : 30, 'core' : 11},
          '10.1088/1367-2630/aa8b9b' : {'all' : 28, 'core' : 11},
          '10.1088/1367-2630/aa7673' : {'all' : 27, 'core' : 11},
          '10.1088/0953-8984/28/10/103002' : {'all' : 26, 'core' : 11},
          '10.1088/1367-2630/ab8ab5' : {'all' : 25, 'core' : 11},
          '10.1088/1367-2630/16/7/073020' : {'all' : 25, 'core' : 11},
          '10.1088/1367-2630/13/3/033027' : {'all' : 25, 'core' : 11},
          '10.1088/1367-2630/18/4/043041' : {'all' : 23, 'core' : 11},
          '10.1088/0022-3719/6/15/009' : {'all' : 22, 'core' : 11},
          '10.1088/1367-2630/17/2/023024' : {'all' : 21, 'core' : 11},
          '10.1088/1367-2630/15/1/015024' : {'all' : 21, 'core' : 11},
          '10.1088/1367-2630/15/1/013057' : {'all' : 21, 'core' : 11},
          '10.1088/1367-2630/14/11/115004' : {'all' : 21, 'core' : 11},
          '10.1088/1367-2630/aaf749' : {'all' : 20, 'core' : 11},
          '10.1088/2040-8986/ab05a8' : {'all' : 19, 'core' : 11},
          '10.1088/1367-2630/5/1/136' : {'all' : 19, 'core' : 11},
          '10.1088/1367-2630/15/7/073037' : {'all' : 19, 'core' : 11},
          '10.1088/1367-2630/ab6f1f' : {'all' : 18, 'core' : 11},
          '10.1088/1367-2630/aa5cff' : {'all' : 16, 'core' : 11},
          '10.1088/1367-2630/aa5fdb' : {'all' : 15, 'core' : 11},
          '10.1088/1009-1963/14/5/006' : {'all' : 15, 'core' : 11},
          '10.1088/1367-2630/ac1808' : {'all' : 14, 'core' : 11},
          '10.1088/0305-4470/36/10/312' : {'all' : 14, 'core' : 11},
          '10.1088/1367-2630/16/6/063065' : {'all' : 132, 'core' : 11},
          '10.1088/1367-2630/ab34e7' : {'all' : 13, 'core' : 11},
          '10.1088/2058-9565/abf599' : {'all' : 12, 'core' : 11},
          '10.1088/1367-2630/ab5ca2' : {'all' : 12, 'core' : 11},
          '10.1088/1367-2630/13/1/013043' : {'all' : 12, 'core' : 11},
          '10.1088/1367-2630/11/2/023002' : {'all' : 12, 'core' : 11},
          '10.1088/0953-4075/40/9/S01' : {'all' : 12, 'core' : 11},
          '10.1088/0305-4470/34/47/329' : {'all' : 12, 'core' : 11},
          '10.1088/2632-2153/abaf98' : {'all' : 11, 'core' : 11},
          '10.1088/1367-2630/aac484' : {'all' : 33, 'core' : 10},
          '10.1088/1367-2630/ab9ee2' : {'all' : 30, 'core' : 10},
          '10.1088/1751-8121/aa7638' : {'all' : 26, 'core' : 10},
          '10.1088/1367-2630/15/12/125013' : {'all' : 26, 'core' : 10},
          '10.1088/1367-2630/17/4/043003' : {'all' : 25, 'core' : 10},
          '10.1088/1742-5468/ab3ccb' : {'all' : 24, 'core' : 10},
          '10.1088/0034-4885/64/6/201' : {'all' : 24, 'core' : 10},
          '10.1088/1367-2630/15/5/053038' : {'all' : 22, 'core' : 10},
          '10.1088/1367-2630/aaea99' : {'all' : 21, 'core' : 10},
          '10.1088/1361-6404/ab9fdd' : {'all' : 21, 'core' : 10},
          '10.1088/0034-4885/80/1/016001' : {'all' : 21, 'core' : 10},
          '10.1209/0295-5075/130/50001' : {'all' : 16, 'core' : 10},
          '10.1088/1367-2630/abfc6a' : {'all' : 15, 'core' : 10},
          '10.1088/1367-2630/aae3ac' : {'all' : 15, 'core' : 10},
          '10.1088/1367-2630/aad9c4' : {'all' : 15, 'core' : 10},
          '10.1088/1751-8121/ab9d46' : {'all' : 14, 'core' : 10},
          '10.1088/1367-2630/18/7/075014' : {'all' : 14, 'core' : 10},
          '10.1088/2632-2153/abc81f' : {'all' : 13, 'core' : 10},
          '10.1088/1367-2630/11/7/075006' : {'all' : 13, 'core' : 10},
          '10.1088/2058-9565/ac0d4c' : {'all' : 12, 'core' : 10},
          '10.1088/2058-9565/abd3db' : {'all' : 12, 'core' : 10},
          '10.1088/1367-2630/aac3be' : {'all' : 12, 'core' : 10},
          '10.1088/0026-1394/13/4/005' : {'all' : 12, 'core' : 10},
          '10.1088/1464-4266/4/3/366' : {'all' : 11, 'core' : 10},
          '10.1088/1367-2630/aaf360' : {'all' : 11, 'core' : 10},
          '10.1088/1367-2630/aae79c' : {'all' : 11, 'core' : 10}}
sample = {'10.3847/1538-3881/abc3c3' : {'all' : 45 , 'core' : 45},
          '10.3847/1538-4357/ab1b41' : {'all' : 113 , 'core' : 113},
          '10.3847/1538-4365/aab766' : {'all' : 116 , 'core' : 116},
          '10.1088/0004-637X/770/2/117' : {'all' : 23 , 'core' : 23},
          '10.1088/2041-8205/812/1/L5' : {'all' : 3 , 'core' : 3},
          '10.3847/1538-3881/aa5be2' : {'all' : 56 , 'core' : 56},
          '10.1088/0067-0049/189/1/240' : {'all' : 312 , 'core' : 312},
          '10.1088/0004-637X/697/1/964' : {'all' : 52 , 'core' : 52},
          '10.3847/1538-4365/ab2241' : {'all' : 285 , 'core' : 285},
          '10.3847/1538-4357/aaf648' : {'all' : 99 , 'core' : 99},
          '10.3847/1538-4357/835/1/29' : {'all' : 416 , 'core' : 416},
          '10.3847/1538-3881/aac387' : {'all' : 424 , 'core' : 424},
          '10.3847/1538-4357/aa5c41' : {'all' : 182 , 'core' : 182}}

jnls = {'1538-3881': 'Astron.J.',
        '0004-637X': 'Astrophys.J.',
        '1538-4357': 'Astrophys.J.',
        '2041-8205': 'Astrophys.J.Lett.',
        '0067-0049': 'Astrophys.J.Supp.',
        '1538-4365': 'Astrophys.J.Supp.',
        '0264-9381': 'Class.Quant.Grav.',
        '1009-9271': 'Chin.J.Astron.Astrophys.',
        '0256-307X': 'Chin.Phys.Lett.',
        '0253-6102': 'Commun.Theor.Phys.',
        '0143-0807': 'Eur.J.Phys.',
        '0295-5075': 'EPL',
        '0266-5611': 'Inv.Problems',
        '1757-899X': 'IOP Conf.Ser.Mater.Sci.Eng.',
        '1742-6596': 'J.Phys.Conf.Ser.',
        '1475-7516': 'JCAP ',
        '1126-6708': 'JHEP ',
        '1748-0221': 'JINST ',
        '1742-5468': 'JSTAT ',
        '0957-0233': 'Measur.Sci.Tech.',
        '1367-2630': 'New J.Phys.',
        '0031-9120': 'Phys.Educ.',
        '1063-7869': 'Phys.Usp.',
        '0034-4885': 'Rept.Prog.Phys.',
        '1674-4527': 'Res.Astron.Astrophys.',
        '1402-4896': 'Phys.Scripta',
        '0953-2048': 'Supercond.Sci.Technol.',
        '2399-6528': 'J.Phys.Comm.',
        '1757-899X': 'IOP Conf.Ser.Mater.Sci.Eng.',
        '0036-0279': 'Russ.Math.Surveys',
        '0951-7715': 'Nonlinearity',
        '0953-4075': 'J.Phys.',
        '0953-8984': 'J.Phys.Condens.Matter',
        '0031-9155': 'Phys.Med.Biol.',
        '1538-3873': 'Publ.Astron.Soc.Pac.',
        '2399-6528': 'J.Phys.Comm.',
        '0741-3335': 'Plasma Phys.Control.Fusion',
        '2515-5172': 'Res.Notes AAS',
        '0026-1394': 'Metrologia'}
jnls['2516-1067'] = 'Plasma Res.Express'
jnls['2633-4356'] = 'Mat.Quant.Tech.'
jnls['1347-4065'] = 'Jap.J.Appl.Phys.'
jnls['2515-7647'] = 'JPhys Photon.'
jnls['2058-9565'] = 'Quantum Sci.Technol.'


jnls['1361-6633'] = 'Rept.Prog.Phys.' 
jnls['0305-4470'] = 'J.Phys.A'
jnls['1751-8113'] = 'J.Phys.A'
jnls['1742-5468'] = 'J.Phys.A'
jnls['1674-1056'] = 'Chin.Phys.B'
jnls['1674-1137'] = 'Chin.Phys.C'
jnls['1361-6455'] = 'J.Phys.B'
jnls['1464-4266'] = 'J.Opt.B'
jnls['1882-0786'] = 'Appl.Phys.Expr.'
jnls['1361-6668'] = 'Supercond.Sci.Technol.'
jnls['0022-3719'] = 'J.Phys.C'
jnls['0305-4608'] = 'J.Phys.F'
jnls['1751-8121'] = 'J.Phys.A'
jnls['0031-8949'] = 'Phys.Scripta'
#jnls[''] = ''

driver.get('https://iopscience.iop.org/')
time.sleep(30)

i = 0
recs = []
missingjournals = []
for doi in sample:
    artlink = 'https://iopscience.iop.org/article/' + doi
    rec = {'doi' : doi, 'tc' : 'P'}
    i += 1
    ejlmod3.printprogress('-', [[i, len(sample)], [doi, sample[doi]['all'], sample[doi]['core']], [len(recs)]])
    if sample[doi]['core'] < 20:
        print('   too, few citations')
        continue
    if skipalreadyharvested and doi in alreadyharvested:
        print('   already in backup')
        continue
    try:
        driver.get(artlink)
        artpage = BeautifulSoup(driver.page_source, features="lxml")
    except:
        print('try "%s" again after 1 minutes' % (artlink))
        time.sleep(60)
        driver.get(artlink)
        artpage = BeautifulSoup(driver.page_source, features="lxml")
    time.sleep(44)
    #jnl
    if re.search('^10.....\/\d\d\d\d\-\d\d\d.\/', doi):
        issn = doi[8:17]
        #print(issn)
        if issn in jnls:
            rec['jnl'] = jnls[issn]
        else:
            mi = doi
            for meta in artpage.find_all('meta', attrs = {'name' : 'citation_journal_title'}):
                mi += ' (%s)' % (meta['content'])
            missingjournals.append(mi)
            continue
    elif re.search('^10.1209\/epl\/', doi):
        rec['jnl'] = 'EPL'
    elif re.search('^10.1238\/Physica.Topical', doi):
        rec['jnl'] = 'Phys.Scripta'
    elif doi in ['10.1070/SM1967v001n04ABEH001994']:
        rec['jnl'] = 'Math.USSR Sb.'
    else:
        mi = doi
        for meta in artpage.find_all('meta', attrs = {'name' : 'citation_journal_title'}):
            mi += ' (%s)' % (meta['content'])
        missingjournals.append(mi)
        continue
    #roboter check
    doimeta = artpage.find_all('meta', attrs = {'name' : 'citation_doi'})
    if not doimeta:
        print('\n !!! ROBO CHECK !!!\n')
        print('try "%s" again after 5 minutes' % (artlink))
        time.sleep(300)
        driver.get(artlink)
        artpage = BeautifulSoup(driver.page_source, features="lxml")
    autaff = False
    #licence
    for divl in artpage.body.find_all('div', attrs = {'class' : 'col-no-break wd-jnl-art-license media'}):
        for a in divl.find_all('a'):
            if a.has_attr('href'):
                if re.search('creativecommons.org', a['href']):
                    rec['licence'] = {'url' : a['href']}
    #metadata
    ejlmod3.metatagcheck(rec, artpage, ['citation_online_date', 'citation_issue', 'citation_doi',
                                        'citation_author', 'citation_author_institution', 'citation_author_orcid',
                                        'citation_author_email', 'citation_abstract', 'citation_reference',
                                        'citation_issue', 'citation_volume'])
    orcidsfound = False
    for meta in artpage.find_all('meta', attrs = {'name' : 'citation_author_orcid'}):
        orcidsfound = True
    if not 'date' in rec:
        ejlmod3.metatagcheck(rec, artpage, ['citation_publication_date'])
    for meta in artpage.find_all('meta'):
        if meta.has_attr('name'):
            if meta['name'] == 'citation_title':
                rec['tit'] = meta['content']
            elif meta['name'] == 'citation_volume':
                if issn in ['1674-1056', '0953-4075']:
                    rec['vol'] = 'B' + meta['content']
                elif issn == '1674-1137':
                    rec['vol'] = 'C' + meta['content']
                elif issn == '1751-8121':
                    rec['vol'] = 'A' + meta['content']
                elif issn == '0954-3899':
                    rec['vol'] = 'G' + meta['content']
                elif issn == '1361-6463':
                    rec['vol'] = 'D' + meta['content']
                else:
                    rec['vol'] = meta['content']
            elif meta['name'] == 'citation_firstpage':
                rec['p1'] = meta['content']
                if issn == '1748-0221' and rec['p1'][0] == 'C':
                    rec['tc'] = 'C'
    #JCAP
    if issn == '1475-7516':
        rec['vol'] = '%s%02i' % (rec['date'][2:4], int(rec['issue']))
        del rec['issue']
    if autaff:
        rec['autaff'].append(autaff)
    #authors if no ORCIDs in meta-section
    if not orcidsfound or not rec['autaff']:
        (auts, aff) = ([], [])
        for authorsection in artpage.body.find_all('span'):
            if authorsection.has_attr('data-authors'):
                break
        for span in authorsection.find_all('span', attrs = {'itemprop' : 'author'}):
            orcid = False
            affis = []
            for sup in span.find_all('sup'):
                affis = re.split(' *, *', sup.text)
                sup.replace_with('')
            author = re.sub('(.*) (.*)', r'\2, \1', span.text.strip())
            for a in span.find_all('a'):
                if a.has_attr('href') and re.search('orcid.org', a['href']):
                    orcid = re.sub('.*orcid.org\/(\d.*[\dX])', r'\1', a['href'])
            if orcid:
                auts.append('%s, ORCID:%s' % (author, orcid))
                orcidsfound = True
            else:
                auts.append(author)
            for affi in affis:
                auts.append('=Aff%s' % (affi))
        for diva in artpage.body.find_all('div', attrs = {'class' : 'wd-jnl-art-author-affiliations'}):
            for p in diva.find_all('p'):
                for sup in p.find_all('sup'):
                    affi = sup.text
                    sup.replace_with('Aff%s= ' % (affi))
                aff.append(p.text)
        if len(auts) >= len(rec['autaff']):
            del rec['autaff']
            rec['auts'] = auts
            rec['aff'] = aff
    #abstract
    for abstr in artpage.body.find_all('div', attrs = {'class' : 'article-text wd-jnl-art-abstract cf'}):
        rec['abs'] = abstr.text.strip()
    #keywords:
    for divk in artpage.body.find_all('div', attrs = {'class' : 'wd-jnl-aas-keywords'}):
        rec['keyw'] = []
        for a in divk.find_all('a'):
            rec['keyw'].append(a.text)
    #get rid of footnotes
    for ul in artpage.body.find_all('ul', attrs = {'class' : 'clear-list wd-content-footnotes'}):
        ul.replace_with('')

    #sample note
    rec['note'] = ['reharvest_based_on_refanalysis',
                   '%i citations from INSPIRE papers' % (sample[doi]['all']),
                   '%i citations from CORE INSPIRE papers' % (sample[doi]['core'])]
    ejlmod3.printrecsummary(rec)
    recs.append(rec)
    ejlmod3.writenewXML(recs[((len(recs)-1) // bunchsize)*bunchsize:], publisher, jnlfilename + '--%04i' % (1 + (len(recs)-1) // bunchsize), retfilename='retfiles_special')
    if missingjournals:
        print('\nmissing journals:', missingjournals, '\n')
    
